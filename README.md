# Тестовое задание

## Формулировка задания
### Создание веб-приложения для управления информацией об автомобилях с использованием API
#### Описание задания:
Вам нужно создать веб-приложение для управления информацией об автомобилях с использованием python (django). Приложение должно включать следующие функции:

1. Управление автомобилями:
- Пользователи могут просматривать список автомобилей.
- Пользователи могут просматривать информацию о каждом автомобиле.
- Только зарегистрированные пользователи могут добавлять новые автомобили.
- Пользователи могут редактировать и удалять только свои записи об автомобилях.

2. Комментарии:
- Зарегистрированные пользователи могут оставлять комментарии к автомобилю.
- Комментарии должны отображаться под соответствующим автомобилем.

3. API:
- Реализуйте REST API для получения, создания, редактирования и удаления автомобилей.
- Реализуйте REST API для получения и добавления комментариев к автомобилям.

4. Регистрация и авторизация:
- Реализуйте регистрацию и авторизацию пользователей.
- Пользователи могут войти в систему и управлять только своими автомобилями.

5. Административная панель:
- Модели автомобилей и комментариев должны быть доступны в административной панели Django.

#### Технические требования:
1. Стек технологий:
- Python
- Django (последняя стабильная версия)
- Django REST Framework (DRF) для реализации API
- База данных SQLite (по умолчанию) или PostgreSQL.

2. Модели:
- Car — модель автомобиля с полями:
  - make (марка автомобиля) — например, "Toyota", "Ford"
  - model (модель автомобиля) — например, "Camry", "Mustang"
  - year (год выпуска) — например, 2020, 2021
  - description (описание автомобиля) — например, "Компактный седан с хорошей экономией топлива", "Спортивный автомобиль с мощным двигателем"
  - created_at (дата и время создания записи)
  - updated_at (дата и время последнего обновления записи)
  - owner (внешний ключ на пользователя, который создал запись)
- Comment — модель комментария с полями:
  - content (содержание комментария) — например, "Отличный автомобиль, но немного шумный на высоких скоростях."
  - created_at (дата и время создания комментария)
  - car (внешний ключ на автомобиль)
  - author (внешний ключ на пользователя)

3. Примеры данных об автомобилях:
- Автомобиль 1: 
  - make: "Toyota"
  - model: "Camry"
  - year: 2021
  - description: "Компактный седан с отличной экономией топлива и современными технологиями безопасности."
- Автомобиль 2:
  - make: "Ford"
  - model: "Mustang"
  - year: 2022
  - description: "Спортивный автомобиль с мощным двигателем и агрессивным дизайном."
- Автомобиль 3:
  - make: "Honda"
  - model: "Civic"
  - year: 2020
  - description: "Надежный и экономичный седан, идеален для городской эксплуатации."

4. Views и шаблоны:
- Реализуйте следующие страницы:
  - Список автомобилей (главная страница).
  - Страница с информацией о конкретном автомобиле и комментариями, а также форма для добавления комментариев.
  - Форма для добавления нового автомобиля (доступна только зарегистрированным пользователям).
  - Форма для редактирования и удаления автомобиля (только для владельца автомобиля).
- Используйте базовый HTML/CSS для минимального оформления страниц.

5. API:
- Используйте Django REST Framework для создания API.
- Реализуйте следующие конечные точки API:
  - GET /api/cars/ — получение списка автомобилей.
  - GET /api/cars/<id>/ — получение информации о конкретном автомобиле.
  - POST /api/cars/ — создание нового автомобиля.
  - PUT /api/cars/<id>/ — обновление информации о автомобиле.
  - DELETE /api/cars/<id>/ — удаление автомобиля.
  - GET /api/cars/<id>/comments/ — получение комментариев к автомобилю.
  - POST /api/cars/<id>/comments/ — добавление нового комментария к автомобилю.

6. Документация:
- Напишите краткую документацию по установке и запуску приложения (например, в README.md файл).
- Укажите, как запустить сервер разработки, как выполнить миграцию базы данных и как использовать API.

#### Оценочные критерии:
1. Код:
- Чистота и структура кода.
- Корректное использование Django ORM и Django REST Framework.
- Наличие адекватных комментариев и документации.
2. Функциональность:
- Полное выполнение всех требований задания.
- Корректность работы всех функций и API.
3. Интерфейс:
- Минимальный пользовательский интерфейс.
4. Безопасность:
- Правильная настройка прав доступа и авторизации.
- Безопасное использование API (например, через аутентификацию).
5. Документация:
- Наличие четкой инструкции по запуску проекта и использованию API.

#### Как сдавать задание:
1. Разработайте проект и разместите его на платформе для управления исходным кодом (например, GitHub).
2. Включите все необходимые файлы для запуска проекта (включая requirements.txt и инструкции по установке).
3. Отправьте ссылку на репозиторий и краткое описание выполненного задания нам.

#### Срок выполнения задания: 1 неделя.


## Старт

1. Клонирование репозитория: Откройте свой терминал и перейдите в каталог, в котором вы хотите сохранить проект. Используйте git clone команду для клонирования репозитория:
```git clone https://github.com/KirillPleshkov/testProject5.git```

2. Перейдите в каталог проекта:
```cd testProject5```

3. Убедитесь, что Docker установлен на вашем компьютере. Вы можете скачать его с [официального сайта Docker](https://www.docker.com/get-started/).

4. Создайте .env-файл и заполните его. Более подробная информация в разделе "ENV файл".

5. При необходимости исправьте docker-compose.yml файл.

6. Поднимите Docker контейнер.
```docker-compose up```

7. Примените миграции.
```python src/manage.py migrate```

8. Создайте суперпользователя.
```python src/manage.py createsuperuser```

После этого ваше приложение будет доступно по адресу http://localhost:8000.

## ENV файл

### Шаблон ENV файла с комментариями:

POSTGRES_HOST=postgres (Для docker оставить таким)

POSTGRES_DB=testProject4DB (название таблицы в БД)

POSTGRES_USER=postgres (name пользователя postgres)

POSTGRES_PASSWORD=rootroot (password пользователя postgres)

POSTGRES_PORT=5432 (порт postgres)

SECRET_KEY=<SECRET_KEY> (сгенерируйте секретный ключ)

## Документация API

#### Регистрация пользователя
POST: ```/api/auth/register/```

Body:
```json
{
    "username": "admin_test",
    "email": "admin_test@a.ru",
    "password": "admin_test"
}
```

Примечание:  
- "email": обязательный формат 'email'
- Поля "username", "email", "password" - обязательные

Response:
```json
{
    "username": "admin_test",
    "email": "admin_test@a.ru"
}
```

Status Codes:
- 201 Created  
- 400 Bad Request

---
#### Авторизация пользователя
POST: ```/api/auth/register/```

Body:
```json
{
    "username": "admin_test",
    "password": "admin_test"
}
```

Примечание:  
- Поля "username", "password" - обязательные;
- В ответе получаем access и refresh токены и самого пользователя.

Response:
```json
{
    "access": "eyJhbGciOiJIUz...",
    "refresh": "eyJhbGciOiJIUz...",
    "user": {
        "pk": 8,
        "username": "admin_test",
        "email": "admin_test@a.ru",
        "first_name": "",
        "last_name": ""
    }
}
```

Status Codes:
- 200 OK 
- 400 Bad Request


---
#### Проверка валидности JWT токена
POST: ```/api/auth/token/verify/```

Body:
```json
{
    "token": "eyJhbGciOiJIUz..."
}
```

Примечание:  
- Поле "token" - обязательное;
- В ответе получаем statusCode: 200 (OK) - токен валидный, 401 (Unauthorized) - токен не валидный.

Response:
```json
{}
```

Status Codes:
- 200 OK 
- 401 Unauthorized


---
#### Refresh токена
POST: ```/api/auth/token/refresh/```

Body:
```json
{
    "refresh": "eyJhbGciOiJIUz..."
}
```

Примечание:  
- Поле "refresh" - обязательное;
- В ответе получаем новый access токен и время когда его действие окончится.

Response:
```json
{
    "access": "eyJhbGciOiJIUz...",
    "access_expiration": "2024-09-07T10:16:04.788832Z"
}
```

Status Codes:
- 200 OK 
- 401 Unauthorized

---
#### Получение списка автомобилей
GET: ```/api/cars/```

Body:
```json
{}
```

Response:
```json
[
  {
        "id": 1,
        "make": "Toyota",
        "model": "Camry",
        "year": 2021,
        "description": "Компактный седан с отличной экономией топлива и современными технологиями безопасности.",
        "created_at": "2024-09-06T09:05:33.041535Z",
        "updated_at": "2024-09-07T09:29:03.088728Z",
        "owner": 1
    },
  ...
]
```

Status Codes:
- 200 OK

---
#### Получение конкретного автомобиля
GET: ```/api/cars/<id>/```

Body:
```json
{}
```

Response:
```json
{
    "id": 1,
    "make": "Toyota",
    "model": "Camry",
    "year": 2021,
    "description": "Компактный седан с отличной экономией топлива и современными технологиями безопасности.",
    "created_at": "2024-09-06T09:05:33.041535Z",
    "updated_at": "2024-09-07T09:29:03.088728Z", 
    "owner": 1
}
```

Status Codes:
- 200 OK
- 404 Not Found

---
#### Создание автомобиля
POST: ```/api/cars/```

Body:
```json
{
    "make": "Марка",
    "model": "Модель",
    "year": 2021,
    "description": "Описание"
}
```

Headers:
```
"Authorization": 'Bearer eyJhbGciOiJIUz...'
```

Примечание:
- Обязательные поля: "make", "model", "year", "description";
- Обязательный заголовок: Authorization (передаем access токен)

Response:
```json
{
    "id": 7,
    "make": "Марка",
    "model": "Модель",
    "year": 2021,
    "description": "Описание",
    "created_at": "2024-09-07T09:49:33.232902Z",
    "updated_at": "2024-09-07T09:49:33.232916Z",
    "owner": 8
}
```

Status Codes:
- 201 Created
- 400 Bad Request
- 401 Unauthorized


---
#### Обновление автомобиля
PUT: ```/api/cars/<id>/```

Body:
```json
{
    "make": "Марка новая",
    "model": "Модель новая",
    "year": 2021,
    "description": "Описание новое"
}
```

Headers:
```
"Authorization": 'Bearer eyJhbGciOiJIUz...'
```

Примечание:
- Обязательные поля: "make", "model", "year", "description";
- Обязательный заголовок: Authorization (передаем access токен)

Response:
```json
{
    "id": 7,
    "make": "Марка новая",
    "model": "Модель новая",
    "year": 2021,
    "description": "Описание новое",
    "created_at": "2024-09-07T09:49:33.232902Z",
    "updated_at": "2024-09-07T09:56:25.012490Z",
    "owner": 8
}
```

Status Codes:
- 200 OK
- 400 Bad Request
- 401 Unauthorized
- 404 Not Found


---
#### Удаление автомобиля
DELETE: ```/api/cars/<id>/```

Body:
```json
{}
```

Headers:
```
"Authorization": 'Bearer eyJhbGciOiJIUz...'
```

Примечание:
- Обязательный заголовок: Authorization (передаем access токен)

Response:
```json
{}
```

Status Codes:
- 200 OK
- 401 Unauthorized
- 403 Forbidden
- 404 Not Found

---
#### Добавление комментария к автомобилю
POST: ```/api/cars/<id>/comments/```

Body:
```json
{
    "content": "Содержимое комментария"
}
```

Headers:
```
"Authorization": 'Bearer eyJhbGciOiJIUz...'
```

Примечание:
- Обязательное поле: "content";
- Обязательный заголовок: Authorization (передаем access токен)

Response:
```json
{
    "id": 7,
    "content": "Содержимое комментария",
    "created_at": "2024-09-07T10:02:41.094621Z",
    "car": 1,
    "author": 8
}
```

Status Codes:
- 201 Created
- 400 Bad Request
- 401 Unauthorized

---
#### Получение комментариев к автомобилю
GET: ```/api/cars/<id>/comments/```

Body:
```json
{}
```

Headers:
```
"Authorization": 'Bearer eyJhbGciOiJIUz...'
```

Примечание:
- Обязательный заголовок: Authorization (передаем access токен)

Response:
```json
[ 
  ...,
    {
        "id": 7,
        "content": "Содержимое комментария",
        "created_at": "2024-09-07T10:02:41.094621Z",
        "car": 1,
        "author": 8
    },
  ...
]
```

Status Codes:
- 200 OK
- 400 Bad Request
- 401 Unauthorized
- 404 Not Found



## Авторизация 

Авторизация реализована с использованием JWT-токенов (access, refresh). 
Для ее реализации используются пакеты: djangorestframework-simplejwt, dj-rest-auth, django-allauth.
Время жизни токена настраивается в настройках (SIMPLE_JWT). 

